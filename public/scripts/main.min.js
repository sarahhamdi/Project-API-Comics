"use strict";var helpers={};helpers.cleanup=function(e,s){var r=String(e);return r=helpers.replaceWeirdChars(r),"[object Object]"==(r=helpers.truncateDesc(r,s))&&(r="Description not available, sorry! It's probably ðŸ”¥ though."),r},helpers.replaceWeirdChars=function(e){return e.replace(/&lt;\/*[a-z]*&gt;/g,"").replace(/&amp;/g,"&").replace(/&lt;br \/&gt;/g," ").replace(/<br \/>/g," ")},helpers.truncateDesc=function(e,s){return e.length>600?e.slice(0,600)+' ... <a href="'+s+'">Read more.</a>':e+'<p><a href="'+s+'">View on Goodreads.</a></p>'},helpers.rating=function(e){for(var s=[],r=parseInt(e),o=0;o<r;o++)s.push('<img class="star" src="public/assets/star.svg">');return s=s.join(" ")},helpers.tpl=function(e){return"http://www.torontopubliclibrary.ca/search.jsp?Ntt="+e},helpers.bookcovers=function(e,s){var r=e,o=/nophoto/,t=o.exec(r),n=e.replace(/m\//g,"l/").replace(/col\//g,"com/");return r=null===o.exec(t)?n:"http://covers.openlibrary.org/b/isbn/"+parseInt(s)+"-L.jpg?default=false"},helpers.bookcoversBlank=function(){$(".bookcover").on("error",function(){console.log("a 404 error"),$(this).attr("src","public/assets/blankcover.png")})},helpers.initSlider=function(){var e=sheetsu.filteredBooks.length-1;if(generic.index==e){console.log("last book");new Swiper(".swiper-container",{pagination:".swiper-pagination",paginationClickable:!0,loop:!0,paginationBulletRender:function(e,s,r){return'<span class="'+r+'">'+(s+1)+"</span>"}})}else generic.index++},helpers.resetSlider=function(){$("#wrapper").empty(),$(".swiper-pagination").empty()},helpers.dropdownCollapseExpand=function(){$("#dropdown").on("click",function(e){e.preventDefault(),$(".dropdown--options").toggleClass("show")})},helpers.printToPage=function(e){var s=e.GoodreadsResponse.book,r=s.title,o=helpers.tpl(s.isbn),t=helpers.bookcovers(s.image_url,s.isbn),n=helpers.cleanup(s.description,s.link),a=helpers.rating(s.average_rating),i=(s.link,void 0),l=(i="[object Object]"==s.publisher?"Not Available":s.publisher,[]),c=(s.authors.author.name?l=s.authors.author.name:s.authors.author.forEach(function(e){l.push(" "+e.name)}),'<p class="flex-item-1">\n            <img src="'+t+'" class="bookcover">\n        </p>\n        <div class="flex-item-2">\n            <h2 class="results-title">'+r+"</h2>\n            <h3>By: "+l+"</h3>\n            <h4>Publisher: "+i+'</h4>\n            <p class="results-description">'+n+'</p>\n            <p class="results-rating">Goodreads Rating</p>\n            <p>'+a+'</p>\n            <p><a href="'+o+'"><img src="public/assets/tpl-logo.svg" class="tpl"></a></p>\n        </div>');$("#wrapper").append('<div class="swiper-slide">'+c+"</div>").addClass("swiper-wrapper"),$("#container").addClass("swiper-container"),$("#pagination").addClass("swiper-pagination"),helpers.bookcoversBlank()},helpers.smoothScroll=function(){$('a[href*="#"]:not([href="#"])').click(function(){if(location.pathname.replace(/^\//,"")==this.pathname.replace(/^\//,"")&&location.hostname==this.hostname){var e=$(this.hash);if((e=e.length?e:$("[name="+this.hash.slice(1)+"]")).length)return $("html, body").animate({scrollTop:e.offset().top},1e3),!1}})};var sheetsu={},goodreads={},generic={},comicsApp={};comicsApp.userInputArray=[],sheetsu.books=[],generic.index=0,sheetsu.endpoint="https://sheetlabs.com/SARA/comicslgbtqpoc?",goodreads.endpoint="https://www.goodreads.com/book/title.xml",goodreads.key="AYoaCzPGXisCTWsP6Ainw",generic.error=function(e){console.log("goodreads error "+e),helpers.initSlider()},goodreads.success=function(e){helpers.printToPage(e),helpers.initSlider()},sheetsu.success=function(e){sheetsu.filtered(e),console.log("working?")},sheetsu.filtered=function(e){sheetsu.filteredBooks=e.filter(function(e){return comicsApp.userInputArray.every(function(s){return"1"===e[s]})}),sheetsu.filteredBooks.map(function(e){console.log(e.bookTitle),goodreads.getData(e.booktitle)})},sheetsu.getData=function(){return $.ajax({url:sheetsu.endpoint,crossDomain:!0,beforeSend:function(e,s){e.setRequestHeader("Authorization","Basic "+btoa("s.hamdi@gmail.com:t_a1ae6e22b56cf1358a57c229a018dd93"))},dataType:"json",type:"GET",success:sheetsu.success,error:generic.error})},goodreads.getData=function(e){return $.ajax({url:"http://proxy.hackeryou.com",dataType:"json",method:"GET",data:{reqUrl:goodreads.endpoint,params:{key:goodreads.key,title:e},xmlToJSON:!0},success:goodreads.success,error:generic.error})},comicsApp.getUserInput=function(){helpers.dropdownCollapseExpand(),$(".choose-comics").on("submit",function(e){$("#results").addClass("show"),$(".dropdown--options").removeClass("show"),$(".footer").removeClass("fixed"),e.preventDefault(),generic.index=0,comicsApp.userInputArray=[],helpers.resetSlider(),$("input:checked").each(function(){comicsApp.userInputArray.push($(this).val())}),sheetsu.getData()})},$(function(){comicsApp.getUserInput(),helpers.smoothScroll()});